<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="e_mto_dinamic.DinamicConfiguratorDialog">
        <Dialog
            title="this.dialogTitle"
            contentClass="'configurator-dialog'"
        >
            <div class="container dinamic_configurator_dialog mt-4">
                <div class="o_list_renderer o_renderer table-responsive">
                    <table class="o_list_table table table-sm table-hover table-striped">
                        <thead class="table-light">
                            <tr>
                                <th class="o_list_number_th text-start" style="width: 30%;">
                                    <span class="fw-semibold">Product Template</span>
                                </th>
                                <th class="o_list_number_th text-start" style="width: 30%;">
                                    <span class="fw-semibold">Product Variant</span>
                                </th>
                                <th class="o_list_number_th text-center" style="width: 10%;">
                                    <span class="fw-semibold">Quantity</span>
                                </th>
                                <th class="o_list_number_th text-end" style="width: 15%;">
                                    <span class="fw-semibold">Unitary Cost</span>
                                </th>
                                <th class="o_list_number_th text-end" style="width: 15%;">
                                    <span class="fw-semibold">Subtotal Cost</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="this.state.dinamic_bill_material_data" 
                                t-as="dinamic_product" 
                                t-key="dinamic_product.uid"
                                class="o_data_row">
                                <td class="o_data_cell text-start">
                                    <span class="o_field_char" t-esc="dinamic_product.product_template.display_name"/>
                                </td>
                                <td class="o_data_cell text-start">
                                    <t t-if="dinamic_product.product_variant_ids">
                                        <select class="form-select" t-att-class="{'select-required': !dinamic_product.product}"
                                                t-on-change="(ev) => this.onChangeVariant(ev, dinamic_product)">
                                            <option t-if="!dinamic_product.product" value="" selected="true"></option>
                                            <option t-foreach="dinamic_product.product_variant_ids"
                                                    t-as="variant"
                                                    t-key="variant.id"
                                                    t-att-value="variant.id"
                                                    t-esc="variant.display_name"
                                                    t-att-selected="dinamic_product.product.id == variant.id"/>
                                        </select>
                                    </t>
                                    <span class="o_field_char" t-else="" t-esc="dinamic_product.product.display_name"/>

                                </td>
                                <td class="o_data_cell text-center">
                                    <EFloat 
                                        value="dinamic_product.qty" 
                                        update="(value) => this.onchangeQty(value,dinamic_product)" 
                                        invalid="(invalid) => this.onchangeInvalid(invalid,dinamic_product)"
                                        digits="[16,0]"
                                        min="0"
                                        />
                                </td>
                                <td class="o_data_cell text-end">
                                    <EMonetary 
                                        readonly="true"
                                        value="dinamic_product.standard_price"
                                        digits="[16,2]"
                                        currencySymbol="this.product.currency_symbol"
                                        currencyPosition="this.product.currency_position"
                                        />
                                </td>
                                <td class="o_data_cell text-end">
                                    <EMonetary 
                                        readonly="true"
                                        value="dinamic_product.subtotal_cost"
                                        digits="[16,2]"
                                        currencySymbol="this.product.currency_symbol"
                                        currencyPosition="this.product.currency_position"/>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr class="o_data_row fw-bold">
                                <td class="o_data_cell text-end" colspan="4">
                                    <span>Total Cost:</span>
                                </td>
                                <td class="o_data_cell text-end">
                                    <EMonetary 
                                        value="this.state.totalCost"
                                        readonly="true"
                                        digits="[16,2]"
                                        class="'me-1'"
                                        currencySymbol="this.product.currency_symbol"
                                        currencyPosition="this.product.currency_position"/>
                                </td>
                            </tr>
                            <tr class="o_data_row fw-bold">
                                <td class="o_data_cell text-end" colspan="4">
                                    <span>Final Cost:</span>
                                </td>
                                <td class="o_data_cell text-end">
                                    <EMonetary 
                                        value="state.finalCost"
                                        update="(value) => this.updateFinalCost(value)"
                                        invalid="(invalid) => this.onchangeInvalidFinalCost(invalid)"
                                        min="0"
                                        digits="[16,2]"
                                        currencySymbol="this.product.currency_symbol"
                                        currencyPosition="this.product.currency_position"
                                        />
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            
            <t t-set-slot="footer">
                <button class="btn btn-primary" t-on-click="confirm" t-att-disabled="this.state.invalidConfirm">
                    Confirm
                </button>
                <button class="btn btn-secondary" t-on-click="cancel">
                    Cancel
                </button>
            </t>
        </Dialog>
    </t>
</templates>